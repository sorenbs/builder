<!doctype html>
<html lang="en" ng-app="builder">
<head>
    <meta charset="utf-8">
    <title>My AngularJS App</title>
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="lib/CodeMirror/lib/codemirror.css" />
    <link rel="stylesheet" href="lib/CodeMirror/theme/ambiance.css"></link>
    <link rel="stylesheet" href="lib/CodeMirror/lib/util/simple-hint.css" />
    <link rel="stylesheet" href="css/editor.css" />
</head>
<body>






    <div class="navbar navbar-fixed-top" ng-controller="MenuCtrl">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="/">CraftyBuilder</a>
                <ul class="nav">
                    <li class="menu_item"><a ng-click="saveToServer();">Save</a> </li>
                    <li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">History
						<b class="caret"></b></a>
                        <ul id="history-menu" class="dropdown-menu">
                            <li><a style="cursor:default">Remember to save!</a></li>
                            <li class="divider"></li>
                            <li ng-repeat="version in versions"><a ng-click="loadVersion(version.version);" title="{{version.comment}}">{{version.version}} | {{version.created|humanDate}} {{version.comment|shorten:25}}</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown">Templates
						<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li ng-repeat="template in templates"><a ng-click="loadTemplate(template.name);">{{template.name}}</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="btn-group pull-right">
                    <button class="btn active">
                        Game</button>
                    <button class="btn">
                        Resources</button>
                </div>
            </div>
        </div>
    </div>




















    <div id="main">
        <div ng-controller="CodeEditorController" id="codeContainer" class="codeContainer">
            <textarea id="Code">
Crafty.init(600, 400);
Crafty.background('rgb(127,127,127)');

//Paddles 
Crafty.e("Paddle, 2D, DOM, Color, Multiway")
	.color('rgb(255,0,0)')
	.attr({ x: 20, y: 200, w: 10, h: 150 })
	.multiway(4, { W: -90, S: 90 });
Crafty.e("Paddle, 2D, DOM, Color, Multiway")
	.color('rgb(0,255,0)')
	.attr({ x: 580, y: 200, w: 10, h: 150 })
	.multiway(4, { UP_ARROW: -90, DOWN_ARROW: 90 });

//Ball
Crafty.e("2D, DOM, Color, Collision")
	.color('rgb(0,0,255)')
	.attr({ x: 300, y: 200, w: 10, h: 10, dX: Crafty.math.randomInt(1, 5), dY: Crafty.math.randomInt(1, 5) })
	.bind('EnterFrame', function () {
		//hit floor or roof
		if (this.y <= 0 || this.y >= 390) {
			this.dY *= -1;
}

		if (this.x > 600) {
			this.x = 300;
			Crafty("LeftPaddle").each(function () { this.text(++this.points + " Points"); });
		}
		if (this.x < 10) {
			this.x = 300;
			Crafty("RightPaddle").each(function () { this.text(++this.points + " Points"); });
		}

		this.x += this.dX;
		this.y += this.dY;
	})
	.onHit('Paddle', function () {
		this.dX *= -1;
	});

//Score boards
Crafty.e("LeftPaddle, DOM, 2D, Text")
	.attr({ x: 20, y: 20, w: 100, h: 20, points: 0 })
	.text("0 Points");
		Crafty.e("RightPaddle, DOM, 2D, Text")
	.attr({ x: 480, y: 20, w: 100, h: 20, points: 0 })
	.text("0 Points");
			
</textarea>
            <!-- scriptEvaluator is used to evaluate the content of the editor -->
            <script id="scriptEvaluator" type="text/javascript"></script>
        </div>
        <div id="gameContainer" class="gameContainer">
            <!-- <div id="assetsContainer" ng-controller="AssetsCtrl" class="resourcesContainer">
				
				<ul class="thumbnails">
					<li ng-repeat="image in images" class="span2">
						<div class="thumbnail">
							<img src="http://placehold.it/160x120" alt="">
							<div class="caption">
								<h5>
									{{image.name}}</h5>
								<p>
									{{image.snippet}}.</p>
								<p>
									<a href="#" class="btn btn-primary">Action</a> <a href="#" class="btn">Action</a></p>
							</div>
						</div>
					</li>
				</ul>
			</div>	
				-->



            <div style="display: block" id="cr-stage">
            </div>
        </div>
        <div ng-controller="ConsoleController" class="consoleContainer">
            <textarea id="Console">
			</textarea>
        </div>







        <script src="lib/jquery/jquery-1.7.1.min.js"></script>
        <script src="lib/angular/angular.js"></script>
        <script src="js/app.js"></script>
        <script src="js/services.js"></script>
        <script src="js/controllers.js"></script>
        <script src="js/filters.js"></script>
        <script src="js/directives.js"></script>
        <script src="lib/jslint/jslint.js"></script>
        <script src="lib/CodeMirror/lib/codemirror.js"></script>
        <script src="lib/CodeMirror/mode/javascript/javascript.js"></script>
        <script src="lib/CodeMirror/lib/util/simple-hint.js"></script>
        <script src="lib/CodeMirror/lib/util/javascript-hint.js"></script>
        <script src="lib/bootstrap/js/bootstrap.js"></script>
        <script src="lib/crafty/crafty.js"></script>





        <script type="text/javascript">

            var evaluateEditorCode = true;
            

            //window.onerror = function (e) {
            //	log(e);
            //}



            /*

			
			var idVersion = [1337, 7331]; // window.location.pathname.split('craft/')[1].split('/');
            var id = idVersion[0];
            var version = idVersion[1];
            console.log(id + " " + version);

            $.ajax({
            	url: "/api/craft/" + id + "/" + version,
            	success: function (data) {
            		if (data.error) {
            			log("AWK!, " + data.error)
            		} else {
            			if (data && data.code != "") {
            				cm.setValue(data.code);
            			}
            			if (data.history) {
            				var historyMenu = $("#history-menu"), historyData = data.history;
            				historyMenu.children().remove();
            				historyMenu.append("<li><a>Remember to save!</a></li>");
            				historyMenu.append("<li class='divider'></li>");
						  
            				for (var c in historyData) {
            					var date = new Date(Date.parse(historyData[c].created));
            					var date_str = ('0' + date.getHours()).substr(-2, 2) + ':' + ('0' + date.getMinutes()).substr(-2, 2) + " " + ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"][date.getMonth()] + " " + date.getDate() ;
            					historyMenu.append("<li><a href='" + historyData[c].version + "' title='" + historyData[c].comment + "'> [" + historyData[c].version + "] " + date_str + " " + historyData[c].comment.substring(0, Math.min(50, historyData[c].comment.length)) + "</a></li>");
            				}

            			}
            		}
            	},
            	dataType: 'json'
            });

            if (version == 0) {
            	log("Welcome to your private playground. Save the url as it will be the only way to get back to your game.");
            	log("If you share this url with others they will be able to edit your game. Consider sharing a fork instead.");
            	log("Press save before you leave the page. I will remember all your old versions.");
            	log("");
            	log("Have fun :-)");
            }

            function postToServer() {
            	log("Saving");
				$.ajax({
            		type: 'POST',
            		url: "/api/craft/save/" + id,
            		data: { code: codeArea.value },
            		success: function (data) {
            			log("Saved version " + data.version);
            		}
            	});
			}

            function loadTemplate() {
            	evaluateEditorCode = false;
            	console.log('!!!!!!!!!!!!!!!');
            	cm.setValue(document.getElementById('pongCode').textContent);
            	evaluateEditorCode = true;
            }
            */
        </script>
    </div>





















</body>
</html>
